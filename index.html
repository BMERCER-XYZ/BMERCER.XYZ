<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BMERCER.XYZ</title>
  <style>
    :root{
      color-scheme: dark;
      --bg:#0b0b10;--fg:#eaeaea;--muted:#8a8f98;--accent:#bd64f8;--card:#141518;--border:#26282d;
    }
    html,body{height:100%; overflow:hidden;}
    body{margin:0;background:var(--bg);color:var(--fg);font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;display:flex;flex-direction:column;}
    #banner{padding:60px; text-align:center; position:relative; z-index:1;}
    
      /* Dynamic ASCII title sizing */
      #banner .ascii-title{
        --ascii-cols: 160;
        --ascii-container-w: min(100vw, 100vw);
        --ascii-padding: 120px; /* banner has padding-left/right 60px each */
        --ascii-max-font: 14px;
        /* scale lets you bump size without changing layout math */
        --banner-scale: 1.7;
        font-size: min(calc(((var(--ascii-container-w) - var(--ascii-padding)) / var(--ascii-cols)) * var(--banner-scale)), var(--ascii-max-font));
        white-space: pre;
        line-height: 0.9;
        color: var(--fg);
        font-weight: bold;
        display: inline-block;
        text-align: center;
        margin: 0;
      }
    .screen-wrap{
      flex:1;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      position: relative;
      z-index:1;
    }
    
    .nav-buttons {
      position: fixed;
      top: 400px;
      left: 250px;
      right: 250px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      pointer-events: none;
      z-index: 10;
    }
    
    .nav-button {
      background: var(--card);
      border: 2px solid var(--border);
      color: var(--fg);
      padding: 12px 50px;
      border-radius: 8px;
  font-family: inherit;
      font-size: 20px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      pointer-events: auto;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    
    .nav-button:hover {
      background: var(--fg);
      color: var(--bg);
      transform: translateY(-2px);
    }
    
    .nav-button:active {
      transform: translateY(0);
    }
    pre#screen{
      margin:0;
      padding:0;
      white-space:pre;
      line-height:1.05;
      tab-size:2;
  text-align:left;
      display:inline-block;
      vertical-align:middle;
      /* dynamic sizing driven by ascii-fit.js */
      --ascii-cols: 160; /* fallback */
      --ascii-rows: 60;  /* fallback, if needed */
      --ascii-container-w: 100vw;
      --ascii-container-h: 100vh;
      --screen-padding: 32px; /* padding left+right */
      --screen-max-font: 10px; /* cap font size */
      /* choose the limiting dimension: width-based char width and height-based char height */
      /* Estimate row height as 1ch*line-height; use width constraint primarily to avoid overflow */
      font-size: min(calc(((var(--ascii-container-w) - var(--screen-padding)) / var(--ascii-cols)) * var(--screen-scale, 1.7)), var(--screen-max-font));
    }
    #mobile-starfield{
      display:none;
      position:fixed;
      inset:0;
      margin:0;
      padding:0;
      white-space:pre;
      line-height:1;
      tab-size:2;
      text-align:left;
      pointer-events:none;
      color:var(--fg);
      opacity:0.25;
      font-family: inherit;
      width:100vw;
      height:100vh;
      min-height:100vh;
      letter-spacing:0;
      font-size:6.5px;
      overflow:hidden;
      z-index:0;
    }
    
    
    /* Scaling for mobile */
    @media (max-width: 800px) {
      html, body {
        display: grid;
        grid-template-rows: auto auto auto;
        height: 100vh;
        overflow: hidden;
        position: fixed;
        width: 100%;
        touch-action: none;
        -webkit-overflow-scrolling: touch;
      }
      #banner {
        display: grid;
        grid-row: 1;
        padding: 10px 5px;
        padding-top: 50px;
        line-height: 0.7;
        /* allow the ASCII to define its own height */
        overflow: visible;
      }
      /* Fit banner ASCII to viewport width exactly (201 columns) */
      #banner .ascii-title{
        --banner-cols: 125;                  /* fixed columns for this banner */
        --banner-pad-x: 10px;                /* banner padding-left+right (5+5) */
        --banner-fudge: 2px;                 /* small safety to avoid subpixel overflow */
        font-size: calc((100vw - var(--banner-pad-x) - var(--banner-fudge)) / var(--banner-cols));
      }
      .screen-wrap {
        grid-row: 2;
        display: grid;
        justify-content: center;
        align-items: start;
        padding: 16px 0 0;
        position: relative;  
      }
      #mobile-starfield {
        display: block;
      }
      .nav-buttons {
        grid-row: 3;
        position: relative;
        top: auto;
        bottom: auto;
        left: auto;
        right: auto;
        transform: none;
        display: grid;
        gap: 24px;
        grid-template-columns: min(80vw, 240px);
        grid-template-rows: repeat(2, 56px);
        width: auto;
        margin: 8px auto 24px;
        justify-content: center;
        align-items: stretch;
      }
      .nav-button {
        padding: 6px 12px;
        font-size: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
    }
    


  </style>
</head>
<body>

  <pre id="mobile-starfield" aria-hidden="true"></pre>

  <div id="banner">
  <pre class="ascii-title" data-col-buffer="0">
__/\\\\\\\\\\\\\____/\\\\____________/\\\\__/\\\\\\\\\\\\\\\____/\\\\\\\\\____________/\\\\\\\\\__/\\\\\\\\\\\\\\\____/\\\\\\\\\____________/\\\_______/\\\__/\\\________/\\\__/\\\\\\\\\\\\\\\_        
 _\/\\\/////////\\\_\/\\\\\\________/\\\\\\_\/\\\///////////___/\\\///////\\\_______/\\\////////__\/\\\///////////___/\\\///////\\\_________\///\\\___/\\\/__\///\\\____/\\\/__\////////////\\\__       
  _\/\\\_______\/\\\_\/\\\//\\\____/\\\//\\\_\/\\\_____________\/\\\_____\/\\\_____/\\\/___________\/\\\_____________\/\\\_____\/\\\___________\///\\\\\\/______\///\\\/\\\/______________/\\\/___      
   _\/\\\\\\\\\\\\\\__\/\\\\///\\\/\\\/_\/\\\_\/\\\\\\\\\\\_____\/\\\\\\\\\\\/_____/\\\_____________\/\\\\\\\\\\\_____\/\\\\\\\\\\\/______________\//\\\\__________\///\\\/______________/\\\/_____     
    _\/\\\/////////\\\_\/\\\__\///\\\/___\/\\\_\/\\\///////______\/\\\//////\\\____\/\\\_____________\/\\\///////______\/\\\//////\\\_______________\/\\\\____________\/\\\_____________/\\\/_______    
     _\/\\\_______\/\\\_\/\\\____\///_____\/\\\_\/\\\_____________\/\\\____\//\\\___\//\\\____________\/\\\_____________\/\\\____\//\\\______________/\\\\\\___________\/\\\___________/\\\/_________   
      _\/\\\_______\/\\\_\/\\\_____________\/\\\_\/\\\_____________\/\\\_____\//\\\___\///\\\__________\/\\\_____________\/\\\_____\//\\\___________/\\\////\\\_________\/\\\_________/\\\/___________  
       _\/\\\\\\\\\\\\\/__\/\\\_____________\/\\\_\/\\\\\\\\\\\\\\\_\/\\\______\//\\\____\////\\\\\\\\\_\/\\\\\\\\\\\\\\\_\/\\\______\//\\\__/\\\__/\\\/___\///\\\_______\/\\\________/\\\\\\\\\\\\\\\_ 
        _\/////////////____\///______________\///__\///////////////__\///________\///________\/////////__\///////////////__\///________\///__\///__\///_______\///________\///________\///////////////__
      </pre>
      <script src="/projects/ascii-fit.js"></script>
    </div>
  <div class="screen-wrap">
    <pre id="screen">Loading...</pre>
  </div>

  <div class="nav-buttons">
    <a href="/projects" class="nav-button">PROJECTS</a>
    <a href="/about" class="nav-button">ABOUT</a>
  </div>


  <script>
    (function(){
      const screenEl = document.getElementById('screen');
      const starEl = document.getElementById('mobile-starfield');
      const mobileQuery = window.matchMedia('(max-width: 800px)');
      let starCtrl = null;
  let screenFitHandle = null;

      const params = new URLSearchParams(location.search);
      const DESKTOP_TOTAL_FRAMES = 300;
      const DESKTOP_SPEED = 0.5;
      const DESKTOP_FOLDER = 'ACII-Frames';
      const DESKTOP_PREFIX = '';
      const DESKTOP_PAD = 4;
      const DESKTOP_EXT = '.txt';
      const DESKTOP_FPS = Number(params.get('fps') || 60);

      function initDesktopAnimation(){
        if (!screenEl) return null;

        const frames = new Array(DESKTOP_TOTAL_FRAMES + 1);
        let framePosition = 1.0;
        let playing = false;
        let timer = null;

        function pathFor(i){
          return `${DESKTOP_FOLDER}/${DESKTOP_PREFIX}${String(i).padStart(DESKTOP_PAD,'0')}${DESKTOP_EXT}`;
        }

        function show(pos){
          const index = Math.max(1, Math.min(DESKTOP_TOTAL_FRAMES, Math.floor(pos)));
          framePosition = pos;
          screenEl.textContent = frames[index] || '';
          if (screenFitHandle && typeof screenFitHandle.update === 'function') {
            screenFitHandle.update();
          }
        }

        function step(){
          let next = framePosition + DESKTOP_SPEED;
          if (next > DESKTOP_TOTAL_FRAMES) next = 1;
          show(next);
        }

        function startAnimation(){
          if (!playing) return;
          const interval = 1000 / DESKTOP_FPS;
          let expected = performance.now() + interval;

          function tick(){
            if (!playing || document.hidden) return;
            const now = performance.now();
            const drift = now - expected;
            if (drift >= 0) {
              step();
              expected += interval;
            }
            timer = setTimeout(tick, Math.max(0, interval - drift));
          }

          tick();
        }

        function play(){
          if (playing) return;
          playing = true;
          startAnimation();
        }

        function stopTimer(){
          if (timer) {
            clearTimeout(timer);
            timer = null;
          }
        }

        function handleVisibility(){
          if (document.hidden) {
            stopTimer();
          } else if (playing) {
            startAnimation();
          }
        }

        document.addEventListener('visibilitychange', handleVisibility);

        async function preload(){
          const tasks = [];
          for (let i = 1; i <= DESKTOP_TOTAL_FRAMES; i++){
            tasks.push(
              fetch(pathFor(i))
                .then(r => { if (!r.ok) throw new Error(`HTTP ${r.status}`); return r.text(); })
                .then(txt => { frames[i] = txt; })
                .catch(err => { frames[i] = `⚠ Failed to load ${pathFor(i)}\n${String(err)}`; })
            );
          }
          await Promise.all(tasks);
          screenEl.textContent = frames[1] || '(empty)';
          if (!screenFitHandle && window.asciiFit) {
            screenFitHandle = window.asciiFit.apply(screenEl, { onResize: true });
          } else if (screenFitHandle && typeof screenFitHandle.update === 'function') {
            screenFitHandle.update();
          }
          framePosition = 1.0;
          play();
        }

        preload();

        return {
          stop(){
            playing = false;
            stopTimer();
            document.removeEventListener('visibilitychange', handleVisibility);
          }
        };
      }

      function initStarfield(){
        if (!starEl) return null;

        const BRIGHTNESS = ['.', '+', '*'];
        const DENSITY = 0.12;
        const STAR_CHAR_SIZE = 6.5;
        const EDGE_SPREAD = 6;
        const EDGE_PADDING = 16;
        const OCCLUSION_SCALE = .5;
        const OCCLUSION_BUFFER = 0;
        let layout = null;
        let grid = [];
        let stars = [];
        let timer = null;
        let active = true;
        let charMetrics = { width: STAR_CHAR_SIZE, height: STAR_CHAR_SIZE };
        let occlusionMask = null;
        let occlusionObserver = null;

        function measureCharMetrics(){
          const probe = document.createElement('span');
          probe.textContent = '0';
          probe.style.position = 'absolute';
          probe.style.visibility = 'hidden';
          probe.style.whiteSpace = 'pre';
          probe.style.fontFamily = window.getComputedStyle(starEl).fontFamily;
          probe.style.fontSize = `${STAR_CHAR_SIZE}px`;
          probe.style.lineHeight = '1';
          probe.style.letterSpacing = '0';
          document.body.appendChild(probe);
          const rect = probe.getBoundingClientRect();
          document.body.removeChild(probe);
          return {
            width: rect.width || STAR_CHAR_SIZE,
            height: rect.height || STAR_CHAR_SIZE
          };
        }

        function computeLayout(){
          const width = window.innerWidth + EDGE_PADDING * 2;
          const height = window.innerHeight;
          const cols = Math.max(80, Math.ceil(width / Math.max(1, charMetrics.width)) + 2);
          const rows = Math.max(60, Math.ceil((height + EDGE_PADDING) / Math.max(1, charMetrics.height)) + 2);
          return { width, height, rows, cols };
        }

        function computeOcclusionMask(){
          if (!layout) return null;
          const target = document.getElementById('screen') || document.querySelector('.screen-wrap');
          if (!target) return null;
          const rect = target.getBoundingClientRect();
          if (!rect.width || !rect.height) return null;
          const charW = Math.max(1, charMetrics.width);
          const charH = Math.max(1, charMetrics.height);
          const colOffset = EDGE_PADDING / charW;
          const rowOffset = EDGE_PADDING / charH;
          const centerCol = colOffset + (rect.left + rect.width / 2) / charW;
          const centerRow = rowOffset + (rect.top + rect.height / 2) / charH;
          const radiusCol = Math.max(4, ((rect.width - OCCLUSION_BUFFER) / 2) / charW * OCCLUSION_SCALE);
          const radiusRow = Math.max(4, ((rect.height - OCCLUSION_BUFFER) / 2) / charH * OCCLUSION_SCALE);
          return { centerCol, centerRow, radiusCol, radiusRow };
        }

        function isOccluded(col, row){
          if (!occlusionMask) return false;
          const nx = (col - occlusionMask.centerCol) / Math.max(1, occlusionMask.radiusCol);
          const ny = (row - occlusionMask.centerRow) / Math.max(1, occlusionMask.radiusRow);
          return (nx * nx + ny * ny) <= 1;
        }

        function pushStarOut(star){
          if (!layout || !occlusionMask) return;
          const angle = Math.random() * Math.PI * 2;
          const radius = Math.max(occlusionMask.radiusCol, occlusionMask.radiusRow) + 2;
          star.x = Math.round(occlusionMask.centerCol + Math.cos(angle) * radius);
          star.y = Math.round(occlusionMask.centerRow + Math.sin(angle) * radius);
          star.x = Math.max(0, Math.min(layout.cols - 1, star.x));
          star.y = Math.max(0, Math.min(layout.rows - 1, star.y));
        }

        function setupOcclusionObserver(){
          const target = document.getElementById('screen');
          if (!target || typeof ResizeObserver === 'undefined') return;
          occlusionObserver = new ResizeObserver(() => {
            occlusionMask = computeOcclusionMask();
            render();
          });
          occlusionObserver.observe(target);
        }

        function rebuild(){
          starEl.style.fontSize = `${STAR_CHAR_SIZE}px`;
          starEl.style.lineHeight = '1';
          starEl.style.letterSpacing = '0';
          charMetrics = measureCharMetrics();
          layout = computeLayout();
          grid = Array.from({ length: layout.rows }, () => Array(layout.cols).fill(' '));
          const starTotal = Math.floor(layout.rows * layout.cols * DENSITY);
          stars = Array.from({ length: starTotal }, () => ({
            x: Math.floor(Math.random() * layout.cols),
            y: Math.floor(Math.random() * layout.rows),
            phase: Math.floor(Math.random() * BRIGHTNESS.length),
            blink: Math.random()
          }));
          const edgeWidth = Math.min(EDGE_SPREAD, Math.floor(layout.cols / 4));
          for (let y = 0; y < layout.rows; y++) {
            const leftX = Math.floor(Math.random() * edgeWidth);
            const rightX = layout.cols - 1 - Math.floor(Math.random() * edgeWidth);
            stars.push({
              x: leftX,
              y,
              phase: Math.floor(Math.random() * BRIGHTNESS.length),
              blink: Math.random()
            });
            stars.push({
              x: Math.max(0, rightX),
              y,
              phase: Math.floor(Math.random() * BRIGHTNESS.length),
              blink: Math.random()
            });
          }
          occlusionMask = computeOcclusionMask();
          if (!occlusionObserver) {
            setupOcclusionObserver();
          }
          render();
        }

        function render(){
          if (!layout) return;
          for (let y = 0; y < layout.rows; y++){
            const row = grid[y];
            for (let x = 0; x < layout.cols; x++){
              row[x] = ' ';
            }
          }
          for (const star of stars){
            const sy = Math.max(0, Math.min(layout.rows - 1, star.y));
            const sx = Math.max(0, Math.min(layout.cols - 1, star.x));
            if (isOccluded(sx, sy)) continue;
            grid[sy][sx] = BRIGHTNESS[star.phase];
          }
          const lines = grid.map(row => row.join('') + '\u00A0');
          starEl.textContent = lines.join('\n');
        }

        function updateStars(){
          if (!layout) return;
          for (const star of stars){
            const chance = 0.25 + star.blink * 0.35;
            if (Math.random() < chance){
              star.phase = (star.phase + 1) % BRIGHTNESS.length;
            }
            if (Math.random() < 0.04){
              star.x = (star.x + (Math.random() < 0.5 ? -1 : 1) + layout.cols) % layout.cols;
              star.y = (star.y + (Math.random() < 0.5 ? -1 : 1) + layout.rows) % layout.rows;
            }
            if (isOccluded(star.x, star.y)) {
              pushStarOut(star);
            }
          }
        }

        function loop(){
          if (!active) return;
          updateStars();
          render();
          if (!active) return;
          timer = setTimeout(loop, 180 + Math.random() * 220);
        }

        const handleResize = () => {
          if (!active) return;
          rebuild();
        };

        rebuild();
        window.addEventListener('resize', handleResize, { passive: true });
        loop();

        return {
          stop(){
            active = false;
            if (timer) {
              clearTimeout(timer);
              timer = null;
            }
            window.removeEventListener('resize', handleResize);
            starEl.textContent = '';
            if (occlusionObserver) {
              occlusionObserver.disconnect();
              occlusionObserver = null;
            }
          }
        };
      }

      function ensureStarfield(){
        if (!starCtrl) {
          starCtrl = initStarfield();
        }
      }

      function deactivateStarfield(){
        if (starCtrl && typeof starCtrl.stop === 'function') {
          starCtrl.stop();
          starCtrl = null;
        }
      }

      function applyMode(){
        if (mobileQuery.matches) {
          ensureStarfield();
        } else {
          deactivateStarfield();
        }
      }

    initDesktopAnimation();
      applyMode();

      if (typeof mobileQuery.addEventListener === 'function') {
        mobileQuery.addEventListener('change', applyMode);
      } else if (typeof mobileQuery.addListener === 'function') {
        mobileQuery.addListener(applyMode);
      }
    })();
  </script>
  <script src="/projects/ascii-fit.js"></script>
</body>
</html>
