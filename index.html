<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BMERCER.XYZ</title>
  <style>
    :root{
      color-scheme: dark;
      --bg:#0b0b10;--fg:#eaeaea;--muted:#8a8f98;--accent:#bd64f8;--card:#141518;--border:#26282d;
    }
    html,body{height:100%; overflow:hidden;}
    body{margin:0;background:var(--bg);color:var(--fg);font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;display:flex;flex-direction:column;}
    #banner{padding:60px; text-align:center; }
    
      /* Dynamic ASCII title sizing */
      #banner .ascii-title{
        --ascii-cols: 160;
        --ascii-container-w: min(100vw, 100vw);
        --ascii-padding: 120px; /* banner has padding-left/right 60px each */
        --ascii-max-font: 14px;
        /* scale lets you bump size without changing layout math */
        --banner-scale: 1.7;
        font-size: min(calc(((var(--ascii-container-w) - var(--ascii-padding)) / var(--ascii-cols)) * var(--banner-scale)), var(--ascii-max-font));
        white-space: pre;
        line-height: 0.9;
        color: var(--fg);
        font-weight: bold;
        display: inline-block;
        text-align: center;
        margin: 0;
      }
    .screen-wrap{
      flex:1;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      position: relative;
    }
    
    .nav-buttons {
      position: fixed;
      top: 400px;
      left: 250px;
      right: 250px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      pointer-events: none;
      z-index: 10;
    }
    
    .nav-button {
      background: var(--card);
      border: 2px solid var(--border);
      color: var(--fg);
      padding: 12px 50px;
      border-radius: 8px;
  font-family: inherit;
      font-size: 20px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      pointer-events: auto;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    
    .nav-button:hover {
      background: var(--fg);
      color: var(--bg);
      transform: translateY(-2px);
    }
    
    .nav-button:active {
      transform: translateY(0);
    }
    pre#screen{
      margin:0;
      padding:16px;
      white-space:pre;
      line-height:1.05;
      tab-size:2;
      text-align:center;
      display:inline-block;
      vertical-align:middle;
      /* dynamic sizing driven by ascii-fit.js */
      --ascii-cols: 160; /* fallback */
      --ascii-rows: 60;  /* fallback, if needed */
      --ascii-container-w: 100vw;
      --ascii-container-h: 100vh;
      --screen-padding: 32px; /* padding left+right */
      --screen-max-font: 10px; /* cap font size */
      /* choose the limiting dimension: width-based char width and height-based char height */
      /* Estimate row height as 1ch*line-height; use width constraint primarily to avoid overflow */
  font-size: min(calc(((var(--ascii-container-w) - var(--screen-padding)) / var(--ascii-cols)) * var(--screen-scale, 1.7)), var(--screen-max-font));
    }
    
    
    /* Scaling for mobile */
    @media (max-width: 800px) {
      html, body {
        display: grid;
        grid-template-rows: 200px var(--ascii-content-h, auto) auto;
        height: 100vh;
        overflow: hidden;
        position: fixed;
        width: 100%;
        touch-action: none;
        -webkit-overflow-scrolling: touch;
      }
      #banner {
        display: grid;
        grid-row: 1;
        padding: 10px 5px;
        padding-top: 50px;
        line-height: 0.7;
        /* allow the ASCII to define its own height */
        overflow: visible;
      }
      /* Fit banner ASCII to viewport width exactly (201 columns) */
      #banner .ascii-title{
        --banner-cols: 125;                  /* fixed columns for this banner */
        --banner-pad-x: 10px;                /* banner padding-left+right (5+5) */
        --banner-fudge: 2px;                 /* small safety to avoid subpixel overflow */
        font-size: calc((100vw - var(--banner-pad-x) - var(--banner-fudge)) / var(--banner-cols));
      }
      .screen-wrap {
        grid-row: 2;
        display: grid;
        justify-content: center;
        align-items: center;
        padding: 0;
        position: relative;  
      }
      pre#screen {
        margin: 0;
      }
      .nav-buttons {
        grid-row: 3;
        position: fixed;
  top: auto;
        bottom: 320px;
        left: 50%;
  right: auto;
        transform: translateX(-50%);
        display: grid;
        gap: 32px;
        grid-template-columns: min(80vw, 260px);
        grid-template-rows: repeat(2, 56px);
        width: auto;
        margin: 0;
        justify-content: center;
        align-items: stretch;
      }
      .nav-button {
        padding: 6px 12px;
        font-size: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
    }
    


  </style>
</head>
<body>


  <div id="banner">
  <pre class="ascii-title" data-col-buffer="0">
__/\\\\\\\\\\\\\____/\\\\____________/\\\\__/\\\\\\\\\\\\\\\____/\\\\\\\\\____________/\\\\\\\\\__/\\\\\\\\\\\\\\\____/\\\\\\\\\____________/\\\_______/\\\__/\\\________/\\\__/\\\\\\\\\\\\\\\_        
 _\/\\\/////////\\\_\/\\\\\\________/\\\\\\_\/\\\///////////___/\\\///////\\\_______/\\\////////__\/\\\///////////___/\\\///////\\\_________\///\\\___/\\\/__\///\\\____/\\\/__\////////////\\\__       
  _\/\\\_______\/\\\_\/\\\//\\\____/\\\//\\\_\/\\\_____________\/\\\_____\/\\\_____/\\\/___________\/\\\_____________\/\\\_____\/\\\___________\///\\\\\\/______\///\\\/\\\/______________/\\\/___      
   _\/\\\\\\\\\\\\\\__\/\\\\///\\\/\\\/_\/\\\_\/\\\\\\\\\\\_____\/\\\\\\\\\\\/_____/\\\_____________\/\\\\\\\\\\\_____\/\\\\\\\\\\\/______________\//\\\\__________\///\\\/______________/\\\/_____     
    _\/\\\/////////\\\_\/\\\__\///\\\/___\/\\\_\/\\\///////______\/\\\//////\\\____\/\\\_____________\/\\\///////______\/\\\//////\\\_______________\/\\\\____________\/\\\_____________/\\\/_______    
     _\/\\\_______\/\\\_\/\\\____\///_____\/\\\_\/\\\_____________\/\\\____\//\\\___\//\\\____________\/\\\_____________\/\\\____\//\\\______________/\\\\\\___________\/\\\___________/\\\/_________   
      _\/\\\_______\/\\\_\/\\\_____________\/\\\_\/\\\_____________\/\\\_____\//\\\___\///\\\__________\/\\\_____________\/\\\_____\//\\\___________/\\\////\\\_________\/\\\_________/\\\/___________  
       _\/\\\\\\\\\\\\\/__\/\\\_____________\/\\\_\/\\\\\\\\\\\\\\\_\/\\\______\//\\\____\////\\\\\\\\\_\/\\\\\\\\\\\\\\\_\/\\\______\//\\\__/\\\__/\\\/___\///\\\_______\/\\\________/\\\\\\\\\\\\\\\_ 
        _\/////////////____\///______________\///__\///////////////__\///________\///________\/////////__\///////////////__\///________\///__\///__\///_______\///________\///________\///////////////__
      </pre>
      <script src="/projects/ascii-fit.js"></script>
    </div>

  </div>
  
  <div class="screen-wrap">
    <pre id="screen">Loading...</pre>
  </div>

  <div class="nav-buttons">
    <a href="/projects" class="nav-button">PROJECTS</a>
    <a href="/about" class="nav-button">ABOUT</a>
  </div>


  <script>
    // ==== CONFIG ====
    const TOTAL_FRAMES = 300;        // number of frames to play
    const FPS = 60;                  // target frames per second
    const SPEED = 0.5;               // animation speed multiplier (1.0 = normal, 0.5 = half speed, 2.0 = double speed)
    const FOLDER = 'ACII-Frames';    // folder containing the .txt files
    const PREFIX = '';         // filename prefix: frame_0001.txt
    const PAD = 4;                   // zero-padding digits
    const EXT = '.txt';              // file extension for frames

    // allow overriding via URL, e.g. ?fps=12
    const params = new URLSearchParams(location.search);
    const fps = Number(params.get('fps') || FPS);

    // DOM refs
    const screenEl = document.getElementById('screen');

  // Font size is driven by ascii-fit.js now

    // state
    let frames = new Array(TOTAL_FRAMES + 1); // 1-indexed for simplicity
    let loaded = 0;
    let playing = false;
    let frameIndex = 1;
    let framePosition = 1.0; // decimal position for smooth speed control
    let timer = null;
    let lastTime = 0; // track last update time

    function pathFor(i){
      return `${FOLDER}/${PREFIX}${String(i).padStart(PAD,'0')}${EXT}`;
    }


  async function preload(){
      const tasks = [];
      for(let i=1;i<=TOTAL_FRAMES;i++){
        tasks.push(
          fetch(pathFor(i))
            .then(r=>{ if(!r.ok) throw new Error(`HTTP ${r.status}`); return r.text(); })
            .then(txt=>{ frames[i] = txt; loaded++; })
            .catch(err=>{ frames[i] = `âš  Failed to load ${pathFor(i)}\n${err}`; loaded++; })
        );
      }
      await Promise.all(tasks);
      screenEl.textContent = frames[1] || '(empty)';
      if (window.asciiFit) {
        // apply fit and re-measure on each frame update
        window.__screenFit = window.asciiFit.apply(screenEl, { onResize: true });
      }
      framePosition = 1.0;
      play();
    }

    function show(i){
      frameIndex = Math.floor(i);
      framePosition = i;
  screenEl.textContent = frames[frameIndex] || '';
  if (window.__screenFit && window.__screenFit.update) window.__screenFit.update();
    }

    function step(){
      const speed = 0.5; // Fixed speed at 0.5
      let next = framePosition + speed;
      
      if(next > TOTAL_FRAMES){
        next = 1; // Always loop
      }
      show(next);
    }

    function play(){
      if(playing) return;
      playing = true;
      startAnimation();
    }

    function startAnimation(){
      if(!playing) return;
      const interval = 1000 / fps;
      let expected = performance.now() + interval;
      
      function tick(){
        if(!playing || document.hidden) return;
        
        const now = performance.now();
        const dt = now - expected;
        if(dt >= 0){ 
          step(); 
          expected += interval; 
        }
        timer = setTimeout(tick, Math.max(0, interval - dt));
      }
      tick();
    }

    function pause(){
      playing = false;
      if(timer) clearTimeout(timer);
    }

    // Handle tab visibility changes
    document.addEventListener('visibilitychange', function() {
      if (document.hidden) {
        // Tab became hidden - stop the animation completely
        if(timer) {
          clearTimeout(timer);
          timer = null;
        }
      } else if (playing) {
        // Tab became visible again - restart animation cleanly
        startAnimation();
      }
    });

    // start
    preload();
  </script>
  <script src="/projects/ascii-fit.js"></script>
</body>
</html>
